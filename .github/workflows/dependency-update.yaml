name: Update dependencies
on: 
  schedule:
    - cron: '0 6 * * 4' # every thursday @ AM 6:00

jobs:
  designer_npm_update_sync:
    runs-on: ubuntu-latest
    name: Update designer npm packages and sync package.json
    steps:
      - name: checkout code
        uses: actions/checkout@v2

      - name: Update package.json
        id: update
        uses: tjololo/npm-package-update-sync@v1
        with:
          root-folder: "src/studio/src/designer"

      - name: Get week number
        id: week
        run: |
          echo "::set-output name=NUMBER::$(date +%U)"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          title: "Updated designer npm dependencies w${{ steps.week.outputs.NUMBER }}"
          branch: "dependencies/designer-npm-updates-w${{ steps.week.outputs.NUMBER }}"
          body: ${{ steps.update.outputs.body }}
          labels: dependencies

  appfrontend_npm_update_sync:
    runs-on: ubuntu-latest
    name: Update App frontend npm packages and sync package.json
    steps:
      - name: checkout code
        uses: actions/checkout@v2

      - name: Update package.json
        id: update
        uses: tjololo/npm-package-update-sync@v1
        with:
          root-folder: "src/Altinn.Apps/AppFrontend/react"

      - name: Get week number
        id: week
        run: |
          echo "::set-output name=NUMBER::$(date +%U)"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          title: "Updated app frontend npm dependencies w${{ steps.week.outputs.NUMBER }}"
          branch: "dependencies/app-frontend-npm-updates-w${{ steps.week.outputs.NUMBER }}"
          body: ${{ steps.update.outputs.body }}
          labels: dependencies

  dotnet_update:
    runs-on: ubuntu-latest
    name: Update dotnet dependencies for studio
    steps:
    - name: checkout code
      uses: actions/checkout@v2
      
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 5.0.x

    - name: update packages
      id: update
      uses: tjololo/nuget-dependencies-update@v1
      with:
        version-limit: 'minor'
        root-folder: "src/studio/src/designer"
        comment-updated: true
        ignore: |
          LibGit2Sharp

    - name: Get week number
      id: week
      run: |
        echo "::set-output name=NUMBER::$(date +%U)"

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        title: "Updated dotnet dependencies w${{ steps.week.outputs.NUMBER }}"
        branch: "dependencies/dotnet-updates-w${{ steps.week.outputs.NUMBER }}"
        body: ${{ steps.update.outputs.body }}
        labels: dependencies