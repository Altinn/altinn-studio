# Docker Compose override file for running all test apps simultaneously
# This configuration builds and runs all test apps from ../../test/apps/
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.testapps.yml up --build
#

services:
  altinn_platform_pdf:
    profiles:
      - disabled # Old PDF generator, not used anymore in newer apps

  localtest_loadbalancer:
    profiles:
      - disabled # Not needed, we're proxying everything in localtest

  altinn_localtest:
    ports:
      - "80:5101"
    environment:
      - LocalPlatformSettings__LocalAppMode=auto

  altinn_testapps:
    container_name: altinn-testapps
    build:
      context: ../../..
      dockerfile: src/test/apps/Dockerfile
    restart: always
    networks:
      - altinntestlocal_network
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "${TEST_DOMAIN:-local.altinn.cloud}:host-gateway"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - AppSettings__OpenIdWellKnownEndpoint=http://altinn_localtest:5101/authentication/api/v1/openid/
      - PlatformSettings__ApiStorageEndpoint=http://altinn_localtest:5101/storage/api/v1/
      - PlatformSettings__ApiRegisterEndpoint=http://altinn_localtest:5101/register/api/v1/
      - PlatformSettings__ApiProfileEndpoint=http://altinn_localtest:5101/profile/api/v1/
      - PlatformSettings__ApiAuthenticationEndpoint=http://altinn_localtest:5101/authentication/api/v1/
      - PlatformSettings__ApiAuthorizationEndpoint=http://altinn_localtest:5101/authorization/api/v1/
      - PlatformSettings__ApiPdf2Endpoint=http://host.docker.internal:5300/pdf
    depends_on:
      - altinn_localtest
