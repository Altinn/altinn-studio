pool:
  name: Altinn Test Self Hosted VM

steps:
- task: DeleteFiles@1
  displayName: 'Delete test results'
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)'
    Contents: '*.xml'
  condition: succeededOrFailed()

- script: |
   echo Execute command: k6 run --quiet $(Build.SourcesDirectory)/src/test/K6/src/tests/platform/pdf/pdf.js -e env=$(environment) -e subskey=$(subsKey)
   
   k6 run  --quiet $(Build.SourcesDirectory)/src/test/K6/src/tests/platform/pdf/pdf.js -e env=$(environment) -e subskey=$(subsKey) | k6-to-junit pdf.xml
   
  workingDirectory: '$(Build.SourcesDirectory)'
  displayName: 'Platform PDF'
  continueOnError: true
  condition: succeededOrFailed()

- task: PublishTestResults@2
  displayName: 'Publish Test Results'
  inputs:
    testResultsFiles: '*.xml'
    searchFolder: '$(Build.SourcesDirectory)'
    mergeTestResults: true
    failTaskOnFailedTests: true
    testRunTitle: '$(environment)_use_cases'
  condition: succeededOrFailed()
