{
	"info": {
		"_postman_id": "fe89ec60-b3cf-42be-8e9b-23b1f94ff6a2",
		"name": "Negative_Tests_Storage_and_App",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "SetUp TestData",
			"item": [
				{
					"name": "Authenticate user",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "405f0af9-b1dd-42cb-acad-8835c9f15dd3",
								"exec": [
									"var current_timestamp = new Date();\r",
									"postman.setEnvironmentVariable(\"current_timestamp\", current_timestamp.toISOString());"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "b4c59095-e73f-4b65-9290-a748b25c7357",
								"exec": [
									"const jar = pm.cookies.jar();",
									"var domain = pm.environment.get(\"envUrl\");",
									"jar.clear(domain, function (error){",
									"    if(error)",
									"    {",
									"        console.log(\"error\",error);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/hal+json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"UserName\": \"{{testUserName}}\",\r\n    \"UserPassword\": \"{{testUserPassword}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{envUrl}}/api/authentication/authenticatewithpassword",
							"protocol": "https",
							"host": [
								"{{envUrl}}"
							],
							"path": [
								"api",
								"authentication",
								"authenticatewithpassword"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Runtime Cookie",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "3642e91a-7bdc-486a-ab19-86d68fb3acee",
								"exec": [
									"var responseAltinnStudioCookie = postman.getResponseCookie(\"AltinnStudioRuntime\");",
									"responseAltinnStudioCookie = responseAltinnStudioCookie.value.toString();",
									"pm.environment.set(\"AltinnStudioRuntime\",responseAltinnStudioCookie);",
									"",
									"const cookieJar = pm.cookies.jar();",
									"var domain = pm.environment.get(\"envUrl\");",
									"cookieJar.set(domain,\"AltinnStudioRuntime\",responseAltinnStudioCookie,function(error,cookie){",
									"    if(error)",
									"    {",
									"        console.log(\"error\",error);",
									"    }",
									"});",
									"",
									"cookieJar.clear(domain, function (error){",
									"    if(error)",
									"    {",
									"        console.log(\"error\",error);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "e2e69b4a-b07a-48bb-b8a7-736a954aa30d",
								"exec": [
									"pm.environment.set(\"AltinnStudioRuntime\",\"\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://platform.{{envUrl}}/authentication/api/v1/authentication?goto=https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"authentication",
								"api",
								"v1",
								"authentication"
							],
							"query": [
								{
									"key": "goto",
									"value": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Party Id",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "6505cb59-4588-4d0c-af60-b5faa7dcb8c1",
								"exec": [
									"if(pm.response.code == 200)",
									"{",
									"    var jsonData = pm.response.json();",
									"    var partyId = jsonData.partyId;",
									"    pm.environment.set(\"instanceOwnerId\",partyId);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "5a8073fb-c692-41da-9b4c-d65247522491",
								"exec": [
									"const cookieJar = pm.cookies.jar();",
									"var domain = pm.environment.get(\"envUrl\");",
									"cookieJar.clear(domain, function (error){",
									"    if(error)",
									"    {",
									"        console.log(\"error\",error);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/api/v1/profile/user",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{app}}",
								"api",
								"v1",
								"profile",
								"user"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST Create Instance",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41557434-30fd-44d6-b2fa-6248c0635824",
								"exec": [
									"if(pm.response.code == 201)\r",
									"{\r",
									"    var jsonData = pm.response.json();\r",
									"    if(pm.expect(jsonData.instanceOwnerId).not.eql(null))\r",
									"    {\r",
									"        pm.environment.set('instanceOwnerId', jsonData.instanceOwner.partyId);\r",
									"        var instanceId = jsonData.id;\r",
									"        instanceId = instanceId.toString();\r",
									"        instanceId = instanceId.split('/');\r",
									"        instanceId = instanceId[1];\r",
									"        pm.environment.set('instanceId',instanceId);\r",
									"        var dataId = jsonData.data[0].id;\r",
									"        pm.environment.set('dataGuid',dataId);\r",
									"    }\r",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9c84f949-10f6-4b99-a342-b7cb58641ee2",
								"exec": [
									"pm.environment.set(\"instanceId\",\"\");",
									"pm.environment.set(\"dataGuid\",\"\");",
									"pm.environment.set(\"processElementId\",\"\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/instances?instanceOwnerPartyId={{instanceOwnerId}}",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{app}}",
								"instances"
							],
							"query": [
								{
									"key": "instanceOwnerPartyId",
									"value": "{{instanceOwnerId}}"
								}
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "147b7979-a781-4be9-870e-cc9349a6419d",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "9f54a269-3647-4af6-b1e9-2d15d187ff32",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Without Authentication",
			"item": [
				{
					"name": "Create App Instance - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41557434-30fd-44d6-b2fa-6248c0635824",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - App - Create App Instance - Status - Unauthorized\", function () {\r",
									"    pm.response.to.have.status(401);\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "f6eb3baa-0d7d-4224-b967-4fa09e1e8570",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"instanceOwner\": {\n    \t\"partyId\": \"{{instanceOwnerId}}\"\n    },\n    \"appId\" : \"{{org}}/{{app}}\",\n    \"dueBefore\": \"2019-06-01T12:00:00Z\",\n    \"visibleAfter\": \"2019-05-20T00:00:00Z\",\n    \"title\": { \"nb\": \"Arbeidsmelding\" }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/instances/",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{app}}",
								"instances",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "PUT Edit Form Data - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "dd484dcc-cd50-417c-9601-7b971fe28e68",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - App - Edit App Data - Status - Unauthorized\", function () {\r",
									"    pm.response.to.have.status(401);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/xml"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "<?xml version=\"1.0\"?>\n<Skjema xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" skjemanummer=\"1472\" spesifikasjonsnummer=\"9812\" blankettnummer=\"AFP-01\" tittel=\"Arbeidsgiverskjema AFP\" gruppeid=\"8818\">\n  <OpplysningerOmArbeidstakeren-grp-8819 gruppeid=\"8819\">\n    <Skjemainstans-grp-8854 gruppeid=\"8854\">\n      <Journalnummer-datadef-33316 orid=\"33316\">9827</Journalnummer-datadef-33316>\n    </Skjemainstans-grp-8854>\n  </OpplysningerOmArbeidstakeren-grp-8819>\n</Skjema>",
							"options": {
								"raw": {
									"language": "xml"
								}
							}
						},
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/instances/{{instanceOwnerId}}/{{instanceId}}/data/{{dataGuid}}",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{app}}",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}",
								"data",
								"{{dataGuid}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET Current Process - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "e57feb48-7aed-48de-bb57-ed220bb65e9d",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - App - GET Current Process - Status - Unauthorized\", function () {\r",
									"    pm.response.to.have.status(401);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/instances/{{instanceOwnerId}}/{{instanceId}}/process",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{app}}",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}",
								"process"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET App Instance by Id - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "f0c6b00b-4213-4095-8a83-f9cf7cc5769e",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - Storage - GET Instance by ID - Status - Unauthorized\", function () {\r",
									"    pm.response.to.have.status(401);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/instances/{{instanceOwnerId}}/{{instanceId}}",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET Instance Data - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "b7a4e821-33f0-4c30-b93b-d8b0b0a2b53a",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - Storage - GET Instance Data - Status - Unauthorized\", function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/instances/{{instanceOwnerId}}/{{instanceId}}/dataelements",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}",
								"dataelements"
							]
						}
					},
					"response": []
				},
				{
					"name": "DELETE events - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "686160fc-c6de-4c3f-904a-fe9528f346a7",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - Storage - DELETE Instance events - Status - Unauthorized\", function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/instances/{{instanceOwnerId}}/{{instanceId}}/events",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}",
								"events"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET All instances - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "86592b19-cde0-42f1-8b7c-297eaee24071",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - Storage - GET SBL Instance - Status - Unauthorized\", function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/sbl/instances/{{instanceOwnerId}}?state=active&language=nb",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"sbl",
								"instances",
								"{{instanceOwnerId}}"
							],
							"query": [
								{
									"key": "state",
									"value": "active"
								},
								{
									"key": "language",
									"value": "nb"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "DELETE Hard Delete Instance - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "f0c6b00b-4213-4095-8a83-f9cf7cc5769e",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - Storage - DELETE Instance - Status - Unauthorized\", function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/sbl/instances/{{instanceOwnerId}}/{{instanceId}}?hard=true",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"sbl",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}"
							],
							"query": [
								{
									"key": "hard",
									"value": "true"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "GET App by name - 401",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "ce37f250-8e44-4034-9ec3-b9ee5feac332",
								"exec": [
									"pm.test(\"Negative Tests - Without Authentication - Storage - GET App info - Status - Unauthorized\", function () {\r",
									"    pm.response.to.have.status(401);\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "8d8e1d9b-b806-4e08-9253-38e5c2b62658",
								"exec": [
									"pm.environment.set(\"attachmentElementType\",\"\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/applications/{{org}}/{{app}}",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"applications",
								"{{org}}",
								"{{app}}"
							]
						}
					},
					"response": []
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Create Instances - User with Lower Security Level Login",
			"item": [
				{
					"name": "App - Create Instance - 403",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41557434-30fd-44d6-b2fa-6248c0635824",
								"exec": [
									"pm.test(\"Negative Tests - User with Lower Security Level Login - App - Create App Instance - Status - Forbidden\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9c84f949-10f6-4b99-a342-b7cb58641ee2",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{level3-app}}/instances?instanceOwnerPartyId={{instanceOwnerId}}",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{level3-app}}",
								"instances"
							],
							"query": [
								{
									"key": "instanceOwnerPartyId",
									"value": "{{instanceOwnerId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Storage - Create App instance - 403",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "f0c6b00b-4213-4095-8a83-f9cf7cc5769e",
								"exec": [
									"pm.test(\"Negative Tests - User with Lower Security Level Login - Storage - Create App Instance - Status - Forbidden\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "d7b24a19-9093-462e-9b6f-a6fd1d7df287",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"instanceOwner\": {\n    \t\"partyId\": \"{{instanceOwnerId}}\"\n    },\n    \"appId\" : \"{{org}}/{{level3-app}}\",\n    \"dueBefore\": \"2019-06-01T12:00:00Z\",\n    \"visibleAfter\": \"2019-05-20T00:00:00Z\",\n    \"title\": { \"nb\": \"Arbeidsmelding\" },\n    \"process\": {\n        \"started\": \"{{current_timestamp}}\",\n        \"startEvent\": \"StartEvent_1\",\n        \"currentTask\": {\n            \"flow\": 2,\n            \"started\": \"{{current_timestamp}}\",\n            \"elementId\": \"Task_1\",\n            \"name\": \"Utfylling\",\n            \"altinnTaskType\": \"data\",\n            \"ended\": null,\n            \"validated\": null\n        },\n        \"ended\": null,\n        \"endEvent\": null\n    }\n}"
						},
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/instances?appId={{org}}/{{level3-app}}",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"instances"
							],
							"query": [
								{
									"key": "appId",
									"value": "{{org}}/{{level3-app}}"
								}
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "231d202d-4e2f-42fd-89ba-286250e4dead",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "7d5be3f5-bd4a-4dd4-aa25-b9a4d215b019",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Access instances without required roles",
			"item": [
				{
					"name": "Create Level 1 App Instance",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41557434-30fd-44d6-b2fa-6248c0635824",
								"exec": [
									"if(pm.response.code == 201)\r",
									"{\r",
									"    var jsonData = pm.response.json();\r",
									"    if(pm.expect(jsonData.instanceOwnerId).not.eql(null))\r",
									"    {\r",
									"        pm.environment.set('instanceOwnerId', jsonData.instanceOwner.partyId);\r",
									"        var instanceId = jsonData.id;\r",
									"        instanceId = instanceId.toString();\r",
									"        instanceId = instanceId.split('/');\r",
									"        instanceId = instanceId[1];\r",
									"        pm.environment.set('instanceId',instanceId);\r",
									"        var dataId = jsonData.data[0].id;\r",
									"        pm.environment.set('dataGuid',dataId);\r",
									"    }\r",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9c84f949-10f6-4b99-a342-b7cb58641ee2",
								"exec": [
									"pm.environment.set(\"instanceId\",\"\");",
									"pm.environment.set(\"dataGuid\",\"\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{level1-app}}/instances?instanceOwnerPartyId={{instanceOwnerId}}",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{level1-app}}",
								"instances"
							],
							"query": [
								{
									"key": "instanceOwnerPartyId",
									"value": "{{instanceOwnerId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Authenticate user2",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "405f0af9-b1dd-42cb-acad-8835c9f15dd3",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "b4c59095-e73f-4b65-9290-a748b25c7357",
								"exec": [
									"const jar = pm.cookies.jar();",
									"var domain = pm.environment.get(\"envUrl\");",
									"jar.clear(domain, function (error){",
									"    if(error)",
									"    {",
									"        console.log(\"error\",error);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/hal+json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"UserName\": \"{{testUserName2}}\",\r\n    \"UserPassword\": \"{{testUserPassword}}\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{envUrl}}/api/authentication/authenticatewithpassword",
							"protocol": "https",
							"host": [
								"{{envUrl}}"
							],
							"path": [
								"api",
								"authentication",
								"authenticatewithpassword"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Runtime Cookie for user2",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "3642e91a-7bdc-486a-ab19-86d68fb3acee",
								"exec": [
									"var responseAltinnStudioCookie = postman.getResponseCookie(\"AltinnStudioRuntime\");",
									"responseAltinnStudioCookie = responseAltinnStudioCookie.value.toString();",
									"pm.environment.set(\"AltinnStudioRuntime\",responseAltinnStudioCookie);",
									"",
									"const cookieJar = pm.cookies.jar();",
									"var domain = pm.environment.get(\"envUrl\");",
									"cookieJar.set(domain,\"AltinnStudioRuntime\",responseAltinnStudioCookie,function(error,cookie){",
									"    if(error)",
									"    {",
									"        console.log(\"error\",error);",
									"    }",
									"});",
									"",
									"cookieJar.clear(domain, function (error){",
									"    if(error)",
									"    {",
									"        console.log(\"error\",error);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "e2e69b4a-b07a-48bb-b8a7-736a954aa30d",
								"exec": [
									"pm.environment.set(\"AltinnStudioRuntime\",\"\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://platform.{{envUrl}}/authentication/api/v1/authentication?goto=https://{{org}}.apps.{{envUrl}}/{{org}}/{{level1-app}}/",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"authentication",
								"api",
								"v1",
								"authentication"
							],
							"query": [
								{
									"key": "goto",
									"value": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{level1-app}}/"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Storage - GET App Instance by Id - 403",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "f0c6b00b-4213-4095-8a83-f9cf7cc5769e",
								"exec": [
									"pm.test(\"Negative Tests - Without Roles - Storage - GET Instance by ID - Status - Forbidden\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/instances/{{instanceOwnerId}}/{{instanceId}}",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "App - GET App Instance by Id - 403",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "f0c6b00b-4213-4095-8a83-f9cf7cc5769e",
								"exec": [
									"pm.test(\"Negative Tests - Without Roles - App - GET Instance by ID - Status - Forbidden\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/instances/{{instanceOwnerId}}/{{instanceId}}",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{app}}",
								"instances",
								"{{instanceOwnerId}}",
								"{{instanceId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "App - Create Instance - 403",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41557434-30fd-44d6-b2fa-6248c0635824",
								"exec": [
									"pm.test(\"Negative Tests - User Without Roles - App - Create App Instance - Status - Forbidden\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9c84f949-10f6-4b99-a342-b7cb58641ee2",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{level1-app}}/instances?instanceOwnerPartyId={{instanceOwnerId}}",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{level1-app}}",
								"instances"
							],
							"query": [
								{
									"key": "instanceOwnerPartyId",
									"value": "{{instanceOwnerId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Storage - Create Instance - 403",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41557434-30fd-44d6-b2fa-6248c0635824",
								"exec": [
									"pm.test(\"Negative Tests - User Without Roles - Storage - Create App Instance - Status - Forbidden\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9c84f949-10f6-4b99-a342-b7cb58641ee2",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"instanceOwner\": {\n    \t\"partyId\": \"{{instanceOwnerId}}\"\n    },\n    \"appId\" : \"{{org}}/{{level1-app}}\",\n    \"dueBefore\": \"2019-06-01T12:00:00Z\",\n    \"visibleAfter\": \"2019-05-20T00:00:00Z\",\n    \"title\": { \"nb\": \"Arbeidsmelding\" },\n    \"process\": {\n        \"started\": \"{{current_timestamp}}\",\n        \"startEvent\": \"StartEvent_1\",\n        \"currentTask\": {\n            \"flow\": 2,\n            \"started\": \"{{current_timestamp}}\",\n            \"elementId\": \"Task_1\",\n            \"name\": \"Utfylling\",\n            \"altinnTaskType\": \"data\",\n            \"ended\": null,\n            \"validated\": null\n        },\n        \"ended\": null,\n        \"endEvent\": null\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/instances?appId={{org}}/{{level1-app}}",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"instances"
							],
							"query": [
								{
									"key": "appId",
									"value": "{{org}}/{{level1-app}}"
								}
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "72a6bf18-23f3-4687-9a29-da4aaa903724",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "dacf3f89-08b5-46d0-a1d1-ff346236ab78",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Access Instances - User with Lower Security Level Login",
			"item": [
				{
					"name": "Get Party Id of user 2",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "6505cb59-4588-4d0c-af60-b5faa7dcb8c1",
								"exec": [
									"if(pm.response.code == 200)",
									"{",
									"    var jsonData = pm.response.json();",
									"    var partyId = jsonData.partyId;",
									"    pm.environment.set(\"instanceOwnerId\",partyId);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{app}}/api/v1/profile/user",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{app}}",
								"api",
								"v1",
								"profile",
								"user"
							]
						}
					},
					"response": []
				},
				{
					"name": "Instances list does not have high security level app instances",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "86592b19-cde0-42f1-8b7c-297eaee24071",
								"exec": [
									"function checkForHighSecLevelInstances() {\r",
									"    if (pm.response.code == 200)\r",
									"    {\r",
									"        var jsonData = pm.response.json();\r",
									"        var instanceCount = jsonData.length;\r",
									"        var level2App = pm.environment.get(\"app\");\r",
									"        var highSecLevelInstanceFound = false ;\r",
									"        for (var i=0;i<instanceCount;i++)\r",
									"        {\r",
									"            if(jsonData[i].appName == level2App)\r",
									"            {\r",
									"                highSecLevelInstanceFound = true ;\r",
									"            }\r",
									"        }\r",
									"        return highSecLevelInstanceFound;\r",
									"    }\r",
									"}\r",
									"\r",
									"pm.test(\"Negative Tests - Access High Security Level Instances - SBL - NotFound \", function () {\r",
									"    var isFound = checkForHighSecLevelInstances();\r",
									"    pm.expect(isFound).to.equal(false);\r",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							}
						],
						"url": {
							"raw": "https://platform.{{envUrl}}/storage/api/v1/sbl/instances/{{instanceOwnerId}}?state=active&language=nb",
							"protocol": "https",
							"host": [
								"platform",
								"{{envUrl}}"
							],
							"path": [
								"storage",
								"api",
								"v1",
								"sbl",
								"instances",
								"{{instanceOwnerId}}"
							],
							"query": [
								{
									"key": "state",
									"value": "active"
								},
								{
									"key": "language",
									"value": "nb"
								}
							]
						}
					},
					"response": []
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "App instantion only by App Owner",
			"item": [
				{
					"name": "Apps instantiation only for App Owner",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "41557434-30fd-44d6-b2fa-6248c0635824",
								"exec": [
									"pm.test(\"Negative Tests - Apps instantiation only for App Owner - App - Create App Instance for InstanceOwner - Status - Forbidden\", function () {\r",
									"    pm.response.to.have.status(403);\r",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9c84f949-10f6-4b99-a342-b7cb58641ee2",
								"exec": [
									"pm.environment.set(\"instanceId\",\"\");",
									"pm.environment.set(\"dataGuid\",\"\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{AltinnStudioRuntime}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{org}}.apps.{{envUrl}}/{{org}}/{{appOwner-only-app}}/instances?instanceOwnerPartyId={{instanceOwnerId}}",
							"protocol": "https",
							"host": [
								"{{org}}",
								"apps",
								"{{envUrl}}"
							],
							"path": [
								"{{org}}",
								"{{appOwner-only-app}}",
								"instances"
							],
							"query": [
								{
									"key": "instanceOwnerPartyId",
									"value": "{{instanceOwnerId}}"
								}
							]
						}
					},
					"response": []
				}
			],
			"protocolProfileBehavior": {}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "e4bdd868-bf3b-4ed4-8bb2-c435f10f0304",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "d9dffbea-520e-4b21-a7ce-d1456a7b5e99",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"protocolProfileBehavior": {}
}
